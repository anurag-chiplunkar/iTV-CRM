{% extends "base.html" %}
{% load static %}

{% block content %}
<!DOCTYPE html>
<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"> 
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.0/axios.min.js"></script>
  <title> </title>
  <style >

  </style>
</head>
<body onload="attachevent()">

<div class="container">
  

<!-- SideBar -->
  <div class="row flex-nowrap">
    
      

        <!-- Main Content -->



    <div class="col py-3">

    <div class="row ">
      
        <!-- NFCT DEAL -->
      <div class="col-8">
        <p>
        <h1>NFCT Deal Detail</h1>
        </p>
        <input type="number" value = '{{nfctbaserate}}' id = "mybase">
        
        </div>

<!-- nfct deal start -->
<form class="row g-3" method="POST" id = "nfct_form" url = "{% url 'nfct:nfct_load_br' %}"> {% csrf_token %}
  {{nfct_deal_formset.management_form}}
  {% for form in nfct_deal_formset %}
 
        <div class="bird-form">
          <!-- <div class="row g-3">

            <div class="col-sm-2">
               {{form.as_p}}
               <hr>
              </div>
              </div> -->
              <!-- {% for field in form %} -->

    <div class="row g-3">

      <div class="col-sm-2">
        <label class="form-label">Channel *</label>
        <div>
        {{form.ref_nfct_channels_id}}
      </div>
      </div>

      <div class="col-sm-2">
        <label class="form-label">Element *</label>
        <div>
        {{form.ref_nfct_elements_id}} 
      </div>
      </div>
    
      <div class="col-sm-2" id = "div_duration">
        <label class="form-label">Duration *</label>
        <div>
        {{form.durations}}
      </div>
      </div>

      <div class="col-sm-2" id = "div_duration_in">
        <label class="form-label">Duration In *</label>
        {{form.duration_in}}
      </div>

      <div class="col-sm-2">
        <label class="form-label">Frequency *</label>
        <input type="number" onkeyup = "cal()" id = 'id_frequency' name = 'frequency' class="form-control">  
      </div>

      <div class="col-sm-2" id = "div_effective_rate">
        <label class="form-label">Effective Rate *</label>
        <input type="number" onkeyup="cal()" id = 'id_effective_rate' name = 'effective_rate' class="form-control">
      </div>

      <div class="col-sm-2" id = "div_total_seconds">
        <label class="form-label">Total Seconds *</label>
        <input type="number" id = 'id_total_seconds' name = 'total_seconds' class="form-control">
      </div>
  
      <div class="col-sm-2">
        <label class="form-label">Base Rate *</label>
        <input type="number" name="base_rate" placeholder="BaseRate" class="form-control" id = "baserate1" value = "{{nfctbaserate}}">
      </div>

      <div class="col-sm-2">
        <label class="form-label">Total *</label>
        {{form.nfct_total}}
      </div>

  </div>
  <!-- {% endfor %} -->
</div>
</form>

  {% endfor %}
  <div class="col-sm-2">
    <button type="submit" class = "btn btn-primary" id="add-form">Add New</button>
  </div>

  <div class="col-sm-2">
    <button type="submit" class = "btn btn-primary">Register Save</button>
    
  </div>
  {% if user.is_authenticated %}
  <div class="col-3" style="margin-top: 20px;">
      <button name="submit" type="submit" class="btn btn-primary"><a href="{% url 'profile' %}" style="color: white; text-decoration-line: none;">Back</a></button>
    </div>
  {% endif %}
</div>


 <div class="row g-3">
 <div class="row g-3">
<hr style="color: blue">
</div>
</div >

        </div>

    </div>

</div>  


<!-- Scripts -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>



<script type="text/javascript">
   
    function attachevent(){


        console.log('Attach')
        var element = document.getElementById('id_form-0-ref_nfct_elements_id');
        element.addEventListener("change", function(){
            var elements = document.getElementById('id_form-0-ref_nfct_elements_id').value
            document.getElementById('div_duration').style.display = 'block'
            document.getElementById('div_duration_in').style.display = 'block'
            document.getElementById('div_effective_rate').style.display = 'block'
            document.getElementById('div_total_seconds').style.display = 'block'

             if (elements === "Aston" || elements === "L Band"){
            document.getElementById('div_duration').style.display = 'none'
            document.getElementById('div_duration_in').style.display = 'none'
             }
             else{
                // document.getElementById('div_effective_rate').style.display = 'none'
                document.getElementById('div_total_seconds').style.display = 'none'
             }
             console.log('inside')
             
    })
    }
</script>


<script type="text/javascript">
    var channel ;  
    var element;           // global variable for storing channel
    $("#id_form-0-ref_nfct_channels_id").change(function () {
      
      channel = $(this).val();  
      console.log(channel, 'channel')
      element = $("#id_form-0-ref_nfct_elements_id").val();
      if (element){
        var url1 = $("#nfct_form").attr("url");
        var data = {
            'element': element , 'channel' :channel   // add the channel and band to the GET                          parameters by default it is GET method
          }
      
      let data1 = new FormData(); // 2
    
        data1.append("Channel", channel)  
        data1.append("Element", element)
        data1.append("csrfmiddlewaretoken", '{{csrf_token}}') // 3
        axios.post(url1, data1) // 4
        .then(function (response) {
          console.log("Response: ",response);
        })
        .catch(function (error) {
          console.log(error, "axios error");
        });
      }
      console.log(channel)  
      console.log(element)    // storing selected channel in trial variable
    })
    ; 
    
    $("#id_form-0-ref_nfct_elements_id").change(function () {
      element = $(this).val();  
      console.log(channel, 'channel***')
      channel = $("#id_form-0-ref_nfct_channels_id").val();
      if (channel){
        var url1 = $("#nfct_form").attr("url");
        var data = {
            'element': element , 'channel' :channel      // add the channel and band to the GET                          parameters by default it is GET method
          }
        // axios.get('https://jsonplaceholder.typicode.com/todos/1', data)
        // axios.post(url1, data)
        // .then(function (response) {
        //   console.log("Response: ",response);
        // })
        // .catch(function (error) {
        //   console.log(error, 'error');
        // });

        // let data2 = new FormData(); // 2
    
        // data2.append("Channel", channel)  
        // data2.append("Element", element)
        // data2.append("csrfmiddlewaretoken", '{{csrf_token}}') // 3
        // axios.post(url1, data2) // 4
        // .then(function (response) {
        //   console.log("Response: ",response);
        // })
        // .catch(function (error) {
        //   console.log(error, 'error1');
        // });

      }
      console.log(channel, "Channel")  
      console.log(element, "Element") 
      
      $.ajax({                       // initialize an AJAX request
        url: url1,                    // set the url of the request (= localhost:8000/hr/ajax/                    load-br/)
        data: {
          'element': element , 'channel' :channel      // add the channel and band to the GET                          parameters by default it is GET method
        },
      success: function (data) {   // `data` is the return of the `load_br` view function
          console.log("API", data)
          // var newval = $('#mybase').attr(value)
          // console.log(newval) 
          var multiidhtml = $(data);
          var multiid = multiidhtml.find('#baserate1').attr("value"); // prints base rate in input type
          console.log(multiid);
          $("#baserate1").val(multiid); 

          var multiid = multiidhtml.find('#mybase').attr("value"); // prints base rate in input type
          console.log(multiid);
          $("#mybase").val(multiid); 

      }
     });
    });



      
    //   var url1 = $("#nfct_form").attr("url");  // storing url....telling ajax to follow                          specified url
    //   var element = $(this).val();   // storing the band selected from row1
    //   console.log(element)
    //   console.log(channel)
      
    //   $.ajax({                       // initialize an AJAX request
    //       url: url1,                 // set the url of the request (= localhost:8000/hr/ajax/                    load-br/)
    //       data: {
    //         'element': element , 'channel' :channel      // add the channel and band to the GET                          parameters by default it is GET method
    //       },
  
              
      // });
    // });
  </script>

    <script type="text/javascript">
        // function aston_lband_cal(){
        //     var f = (document.getElementById('id_frequency').value)
        //     console.log(f)
        //     var freq = f * 10;
        //     console.log(freq) 
        //     document.getElementById('id_total_seconds').value = freq
        // }
        
       
        // var f = $('#id_frequency').val();
        // function frequency(f){
        //     var fq = parseInt(f)
        //     var freq = fq * 10;
        //     document.getElementById('id_total_seconds').value = freq
        // }
        
        // function logobug(){
        //     var freq1 = document.getElementById('id_frequency').value
        //     var base_rate1 = document.getElementById('nfct_baserate1').value
        //     var logo_total = freq1 * base_rate1
        //     document.getElementById('id_nfct_total').value = logo_total;
        // }
        
        function cal(){
            var elements = document.getElementById('id_form-0-ref_nfct_elements_id').value;
            console.log(elements.value, '*****************')
            if (elements === "Aston" || elements === "L Band"){
                var f = (document.getElementById('id_frequency').value)
                console.log(f)
                var freq = f * 10;
                console.log(freq) 
                document.getElementById('id_total_seconds').value = freq
                var eff_rate = document.getElementById('id_effective_rate').value
                var tot_sec = document.getElementById('id_total_seconds').value
                var total = eff_rate * tot_sec
                document.getElementById('id_form-0-nfct_total').value = total;
        }
            else{
                var freq1 = document.getElementById('id_frequency').value
                var base_rate1 = document.getElementById('id_effective_rate').value
                var logo_total = freq1 * base_rate1
                document.getElementById('id_form-0-nfct_total').value = logo_total;
        }
        }
    </script>


<!-- <script>
  const addMoreButton = document.getElementById('add')
  addMoreButton.addEventListener('click', add_new_form)

  function add_new_form(event){
      if (event) {
          event.preventDefault()
      }
      console.log('inside function')
      const formcopy = document.getElementById('nfct-form-list')
      const empty_form = document.getElementById('empty-form').cloneNode(true)
      empty_form.setAttribute('class', 'nfct-form')
      formcopy.append(empty_form)
  }   

</script> -->

<script>
  let birdForm = document.querySelectorAll(".bird-form")
  let container = document.querySelector("#nfct_form")
  let addButton = document.querySelector("#add-form")
  let totalForms = document.querySelector("#id_form-TOTAL_FORMS")

  let formNum = birdForm.length-1
  addButton.addEventListener('click', addForm)

  function addForm(e){
      e.preventDefault()

      let newForm = birdForm[0].cloneNode(true)
      let formRegex = RegExp(`form-(\\d){1}-`,'g')

      formNum++
      newForm.innerHTML = newForm.innerHTML.replace(formRegex, `form-${formNum}-`)
      container.insertBefore(newForm, addButton)
      
      totalForms.setAttribute('value', `${formNum+1}`)
  }
</script>








   <!-- <script type="text/javascript">
        function OnChangeCheckbox1 (checkbox) {
            if (checkbox.checked) {
                // alert ("The check box is checked.");
                document.getElementById("FCT").style.display = 'block';
            }
            else {
                // alert ("The check box is not checked.");
                 document.getElementById("FCT").style.display = 'none';
            }
        }

        function OnChangeCheckbox2 (checkbox) {
            if (checkbox.checked) {
                // alert ("The check box is checked.");
                document.getElementById("Non_FCT").style.display = 'block';
            }
            else {
                // alert ("The check box is not checked.");
                 document.getElementById("Non_FCT").style.display = 'none';
            }
        }
    </script> -->


<!-- <script type="text/javascript">
  function showdiv(){
    var val = event.target.options[event.target.selectedIndex].value;
    if ((val === "25%-25%-50%") || (val === "33%-33%-33%") || (val === "40%-20%-40%")){
      console.log("yes");
      document.getElementById("row1").style.display = "flex";
      document.getElementById("row2").style.display = "flex";
      document.getElementById("row3").style.display = "flex";
      document.getElementById("row4").style.display = "flex";
    }
    if (val === "50%-50%"){
      document.getElementById("row1").style.display = "flex";
      document.getElementById("row2").style.display = "flex";
      document.getElementById('row3').style.display = "none";
      document.getElementById("row4").style.display = "flex";
    }
  }
  function calculate1 (){
      var box1 = document.getElementById('fct1').value;
      
      var box2 = document.getElementById('er1').value;
      
      var result = document.getElementById('rev1');
      var mul1 = (box1/10) * box2;
      
      result.value = mul1;

    }
    function calculate2 (){
      var box21 = document.getElementById('fct2').value;
      
      var box22 = document.getElementById('er2').value;
      
      var result1 = document.getElementById('rev2');
      var mul21 = (box21/10) * box22;
      
      result1.value = mul21;

    }
    function calculate3 (){
      var box31 = document.getElementById('fct3').value;
      
      var box32 = document.getElementById('er3').value;
      
      var result2 = document.getElementById('rev3');
      var mul31 = (box31/10) * box32;
      
      result2.value = mul31;

    }
    function sum(){
      // var num1 = parseInt(document.getElementById('a_fct1').value);
      // var num2 = parseInt(document.getElementById('a_fct2').value);
      // var num3 = document.getElementById('a_fct3').value;
      // var add = num1 + num2 + num3;
      // console.log("i am in");
      // console.log(add);
      // document.getElementById('totalbox').value = add;
      var first_number = parseInt(document.getElementById("rev1").value);
      var second_number = parseInt(document.getElementById("rev2").value);
      var third_number = parseInt(document.getElementById("rev3").value);
      var result = first_number + second_number + third_number;

      document.getElementById("totalbox").value = result;
    }
</script> -->
<!-- <script type="text/javascript">
        function OnChangeCheckbox3 (checkbox) {
            if (checkbox.checked) {
                // alert ("The check box is checked.");
                document.getElementById("aston").style.display = 'block';
                var abc = document.getElementById("aston1")
                if (abc.checked==true){
                  console.log("-------------")
                }
            }
            else {
                // alert ("The check box is not checked.");
                 document.getElementById("aston").style.display = 'none';
            }
        }

        function OnChangeCheckbox4 (checkbox) {
            if (checkbox.checked) {
                // alert ("The check box is checked.");
                document.getElementById("lband").style.display = 'block';
            }
            else {
                // alert ("The check box is not checked.");
                 document.getElementById("lband").style.display = 'none';
            }
        }

        function OnChangeCheckbox5 (checkbox) {
            if (checkbox.checked) {
                // alert ("The check box is checked.");
                document.getElementById("logobug").style.display = 'block';
            }
            else {
                // alert ("The check box is not checked.");
                 document.getElementById("logobug").style.display = 'none';
            }
        }

        function OnChangeCheckbox6 (checkbox) {
            if (checkbox.checked) {
                // alert ("The check box is checked.");
                document.getElementById("sponsorshiptag").style.display = 'block';
            }
            else {
                // alert ("The check box is not checked.");
                 document.getElementById("sponsorshiptag").style.display = 'none';
            }
        }

        function OnChangeCheckbox7 (checkbox) {
            if (checkbox.checked) {
                // alert ("The check box is checked.");
                document.getElementById("ticker").style.display = 'block';
            }
            else {
                // alert ("The check box is not checked.");
                 document.getElementById("ticker").style.display = 'none';
            }
        }

        function OnChangeCheckbox8 (checkbox) {
            if (checkbox.checked) {
                // alert ("The check box is checked.");
                document.getElementById("wheatherbranding").style.display = 'block';
            }
            else {
                // alert ("The check box is not checked.");
                 document.getElementById("wheatherbranding").style.display = 'none';
            }
        }
</script> -->
<!-- <script>
  var trial ;             // global variable for storing channel
  $("#channel").change(function () {
    
    trial = $(this).val(); 
    console.log(trial)       // storing selected channel in trial variable
  }); 
  
  $("#band1").change(function () {
    
    var url1 = $("#fct_form").attr("url");  // storing url....telling ajax to follow                          specified url
    var band_dd1 = $(this).val();   // storing the band selected from row1
    console.log(band_dd1)
    console.log(trial)
    
    $.ajax({                       // initialize an AJAX request
        url: url1,                    // set the url of the request (= localhost:8000/hr/ajax/                    load-br/)
        data: {
          'band1': band_dd1 , 'channel' :trial      // add the channel and band to the GET                          parameters by default it is GET method
        },

        success: function (data) {   // `data` is the return of the `load_br` view function
        // console.log(data)
        var multiidhtml = $(data);

        var multiid = multiidhtml.find('#base1').attr("value"); // prints base rate in input type
        console.log(multiid);
              $("#base1").val(multiid);     // replace the contents of the band1 input with the                   data that came from the server
          }
        
    });
  });

  $("#band2").change(function () {
    
    var url1 = $("#fct_form").attr("url2");  // storing url....telling ajax to follow                           specified url
    var band_dd2 = $(this).val();   // storing the band selected from row1
    console.log(band_dd2);
    
    $.ajax({                       // initialize an AJAX request
        url: url1,                    // set the url of the request (= localhost:8000/hr/ajax/                    load-br/)
        data: {
          'band2': band_dd2 , 'channel' :trial      // add the channel and band to the GET                          parameters by default it is GET method
        },

        success: function (data) {   // `data` is the return of the `load_br` view function
         
      var multiidhtml = $(data);
      var multiid = multiidhtml.find('#base2').attr("value"); // prints base rate in input type
      console.log(multiid);
            $("#base2").val(multiid);     // replace the contents of the band1 input with the                   data that came from the server
        }
        
    });
  });

  $("#band3").change(function () {
    
    var url2 = $("#fct_form").attr("url3");  // storing url....telling ajax to follow                           specified url
    var band_dd3 = $(this).val();   // storing the band selected from row1
    console.log(band_dd3);
    
    $.ajax({                       // initialize an AJAX request
        url: url2,                    // set the url of the request (= localhost:8000/hr/ajax/                    load-br/)
        data: {
          'band3': band_dd3 , 'channel' :trial      // add the channel and band to the GET                          parameters by default it is GET method
        },

        success: function (data) {   // `data` is the return of the `load_br` view function
         
      var multiidhtml = $(data);
      var multiid = multiidhtml.find('#base3').attr("value"); // prints base rate in input type
      console.log(multiid);
            $("#base3").val(multiid);     // replace the contents of the band1 input with the                   data that came from the server
        }
        
    });
  });

</script> -->
<!-- afp -->
<!-- <script type="text/javascript">
  var tr ;             // global variable for storing channel
  $("#newschannels").change(function () {
    
    tr = $(this).val();  
    console.log(tr)      // storing selected channel in trial variable
  }); 
  
  $("#id_ref_program_name").change(function () {
    
    var url1 = $("#afp_form").attr("url");  // storing url....telling ajax to follow                          specified url
    var band_dd1 = $(this).val();   // storing the band selected from row1
    console.log(band_dd1)
    console.log(tr)
    
    $.ajax({                       // initialize an AJAX request
        url: url1,                    // set the url of the request (= localhost:8000/hr/ajax/                    load-br/)
        data: {
          'program_name': band_dd1 , 'channel' :tr      // add the channel and band to the GET                          parameters by default it is GET method
        },

        success: function (data) {   // `data` is the return of the `load_br` view function
        console.log(data)
        var multiidhtml = $(data);

        var multiid = multiidhtml.find('#baserate1').attr("value"); // prints base rate in input type
        console.log(multiid);
              $("#baserate1").val(multiid);     // replace the contents of the band1 input with the                   data that came from the server
          }
        
    });
  });
</script> -->

{% endblock %}
</body> 
</html>