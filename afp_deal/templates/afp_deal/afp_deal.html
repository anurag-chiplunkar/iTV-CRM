{% load static %}

<!DOCTYPE html>
<html>
<head>
  <title>iTV Network: Current India News, Top Headlines, Live Updates, English News India, Hindi News, Regional Updates India, Videos, Photos and More – ITV NETWORK: Connecting Dots…</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
</head>
<body>

<!-- AFP Deal -->
<div class="container">
<form class="row g-2" method="POST" id = "afp_deal_form" url="{% url 'afp_deal:afp_deal_load_br' %}">{% csrf_token %}
  {%load crispy_forms_tags %}
  <label for="client_pri_ctc" style="font-weight: bold;font-size: 23px;">AFP Deal</label> 
  <div class="row g-2">
    <div class="col-sm-2">
    {{afp_deal_form.ref_program_name|as_crispy_field}}
  </div>
  <div class="col-sm-2">
    {{afp_deal_form.ref_channels|as_crispy_field}}
  </div>
  
  <div class="col-sm-2">
    {{afp_deal_form.ref_promos|as_crispy_field}}
  </div>

  <div class="col-sm-2">
    {{afp_deal_form.ref_slot|as_crispy_field}}
  </div>

  <div class="col-sm-2">
    {{afp_deal_form.afp_eff_rate|as_crispy_field}}
  </div>
  
  <div class="col-sm-2">
    <label class="form-label">Base Rate *</label>
    <input type="text" name="afp_baserate" placeholder="Base Rate" class="form-control" id = "baserate1">
  </div>



  <div class="container">
    <div class="row mt-3">
        <div class="col-md-12 mb-5 text-right" style="margin-top: 20px;">
            <button type="submit" class="btn btn-primary float-right">Save Deal</button>
        </div>
    </div>
    </div>
  
  {% if user.is_authenticated %}
  <div class="col-3" style="margin-top: 20px;">
      <button name="submit" type="submit" class="btn btn-primary"><a href="{% url 'profile' %}" style="color: white; text-decoration-line: none;">Back</a></button>
    </div>
  {% endif %}
  </div>
</form>
</div>


<script>
  //Script for dynamically populating the base rate
  // global variable afp program name
  var afp_program_name ;							                
	
  // storing selected program name in 'afp_program_name' variable
  $("#id_ref_program_name").change(function () {
  
    afp_program_name = $(this).val();
    console.log("AFP Program Name:",afp_program_name);
});	

var afp_channel ;

  // storing selected afp channel in afp_channel variable
$("#id_ref_channels").change(function () {
  
  afp_channel = $(this).val();			
  console.log("AFP Channel:",afp_channel);

  var url = $("#afp_deal_form").attr("url");  
  console.log("URL:",url)

  $.ajax({                       // initialize an AJAX request
      url: url,                    
      data: {
        'program_name': afp_program_name , 'channel' :afp_channel 
      },

      success: function (data) {   // `data` is the return of the `afp_deal_load_br` view function
       
    console.log("Data:",data);
    document.getElementById('baserate1').value = data;
      }
      
  });
});	

</script>
</body>
</html>